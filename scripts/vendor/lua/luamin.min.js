function hashString(e){for(var t=0,n=e.length;n--;)t+=e.charCodeAt(n),t+=t<<10,t^=t>>6;return t+=t<<3,t^=t>>11,t+=t<<15}const print=()=>null,error=console.error,assert=function(e,t){if(!e)throw t};function parseFloat(e,t){if(!e)return 0;var n=e.toString().split(".");return n.length>1?parseInt(n[0],t)+parseInt(n[1],t)/Math.pow(t,n[1].length):parseInt(n[0],t)}let WhiteChars=[" ","\n","\t","\r"],Main_CharacterForEscape={r:"\r",n:"\n",t:"\t",'"':'"',"'":"'","\\":"\\"};const CharacterForEscape=new Proxy(Main_CharacterForEscape,{get:(e,t)=>parseFloat(t)});let AllIdentStartChars=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","_","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],AllIdentChars=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","_","a","b","c","d","e","f","g","t","u","v","w","h","i","j","k","l","m","n","o","p","q","r","s","x","y","z"],Digits=["0","1","2","3","4","5","6","7","8","9"],HexDigits=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","A","B","C","D","E","F"],BinaryDigits=["0","1"],Symbols=["+","-","*",")",";","/","^","%","#",",","{","}",":","[","]","(",".","`"],EqualSymbols=["~","=",">","<"],CompoundSymbols=["+","-","*","/","^","..","%"],Compounds=["+=","-=","*=","/=","^=","..=","%="],Keywords=["and","break","do","else","elseif","end","false","for","function","goto","if","in","local","nil","not","or","repeat","return","then","true","until","while","continue"],BlockFollowKeyword=["else","elseif","until","end"],UnopSet=["-","not","#","~"],BinopSet=["+","-","*","/","%","^","#","//","&","|","~","<<",">>","..",".",":",">","<","<=",">=","~=","==","+=","-=","*=","/=","%=","^=","..=","and","or"],UnaryPriority=11,BinaryPriority={"^":[13,12],"%":[10,10],"//":[10,10],"/":[10,10],"*":[10,10],"+":[9,9],"-":[9,9],"..":[8,7],">>":[7,7],"<<":[7,7],"&":[6,6],"~":[5,5],"|":[4,4],"==":[3,3],"~=":[3,3],">=":[3,3],"<=":[3,3],">":[3,3],"<":[3,3],"+=":[3,3],"-=":[3,3],"*=":[3,3],"/=":[3,3],"^=":[3,3],"%=":[3,3],"..=":[3,3],and:[2,2],or:[1,1]};function CreateLuaTokenStream(e){let t=0,n=e.length,o=[];function r(o){return o=o||0,t<=n?e.substr(t+o,1):""}function i(){if(t<=n){let n=e.substr(t,1);return t++,n}return""}function a(n){let r,i=1,a=1;for(;0<=t;)"\n"==e.substr(0,1)?(i++,a=1):a++;for(r=0;r<o.length;r++){let e=o[r];print(`${e.Type}<${e.Source}>`)}throw`file<${i}:${a}>: ${n}`}function l(e){for(;;){let n=i();if(""==n)a("Unfinished long string.");else if("]"==n){let n,o=!0;for(n=1;n<=e;n++){if("="!=r()){o=!1;break}t++}if(o&&"]"==i())return}}}function s(){let e=t;for(;"="==r();)t++;return"["==r()?(t++,t-e-1):void(t=e)}let u=0,T=0;function p(n){0;let r=e.substr(T,t-T),i=null;"Number"==n&&("0x"==r.substr(0,2).toLowerCase()?(i="hex",parseInt(r,16)<999999999999&&(r=parseInt(r,16))):"0b"==r.substr(0,2).toLowerCase()&&(i="bin",parseInt(r.substr(2),2)<999999999999&&(r=parseInt(r.substr(2),2))));let a={Type:n,LeadingWhite:e.substr(u,T-u),Source:r};return null!==i&&(a.NType=i),o.push(a),u=t,T=t,a}for(;;){for(u=t;;){let e=r();if(""==e)break;if("-"==e){if("-"!=r(1))break;if(t+=2,"["==r()){t++;let e=s();if(null!=e)l(e),u=t;else for(;;){let e=i();if(""==e||"\n"==e)break}}else for(;;){let e=i();if(""==e||"\n"==e)break}}else{if(!WhiteChars.includes(e))break;t++}}e.substr(u,t-u);T=t;let n=i();if(""==n){p("Eof");break}if("'"==n||'"'==n){for(;;){let e=i();if("\\"==e){let e=i();if(null==CharacterForEscape[e])throw`Invalid Escape Sequence \`${e}\`.`}else{if(e==n)break;if(""==e)throw"Unfinished string!"}}p("String")}else if("`"==n){for(;;){let e=i();if("\\"==e){let e=i();if(null==CharacterForEscape[e])throw`Invalid Escape Sequence \`${e}\`.`}else{if(e==n)break;if(""==e)throw"Unfinished string!"}}p("Hash")}else if(AllIdentStartChars.includes(n)){for(;AllIdentChars.includes(r());)t++;Keywords.includes(e.substr(T,t-T))?p("Keyword"):p("Ident")}else if(Digits.includes(n)||"."==n&&Digits.includes(r())){if("0"==n&&"x"==r().toLowerCase())for(t++;HexDigits.includes(r())||"_"===r();)t++;else if("0"==n&&"b"==r().toLowerCase())for(t++;BinaryDigits.includes(r())||"_"===r();)t++;else{for(;Digits.includes(r())||"_"===r();)t++;if("."==r())for(t++;Digits.includes(r());)t++;if("e"==r()||"E"==r())for(t++,"-"!=r()&&"+"!=r()||t++;Digits.includes(r());)t++}p("Number")}else if("["==n){let e=s();null!=e?(l(e),p("String")):p("Symbol")}else if("."==n)"."==r()&&(i(),("."==r()||"="==r())&&i()),p("Symbol");else if(BinopSet.includes(n+r()))i(),p("Symbol");else if(EqualSymbols.includes(n))"="==r()&&t++,p("Symbol");else if(CompoundSymbols.includes(n)&&"="==r())i(),p("Symbol");else{if(!Symbols.includes(n))throw`Bad symbol \`${n}\` in source. ${t}`;p("Symbol")}}return o}function CreateLuaParser(e){let t,n,o=CreateLuaTokenStream(e),r=0;function i(){let e=o[r];return r<o.length&&r++,e}function a(e){return o[e=r+(e||0)]||o[o.length-1]}function l(e){let t=1,n=0,r=0;for(;;){let i,a,l=o[r];for(i=l==e?l.LeadingWhite:l.LeadingWhite+l.Source,a=0;a<=i.length;a++){"\n"==i.substr(a,1)?(t++,n=0):n++}if(l==e)break;r++}return`${t}:${n+1}`}function s(){let e=a();return"Eof"==e.Type||"Keyword"==e.Type&&BlockFollowKeyword.includes(e.Source)}function u(e,t){let n=a();if(n.Type!=e||null!=t&&n.Source!=t){let o;for(o=-3;o<=3;o++)print(`Tokens[${o}] = \`${a(o).Source}\``);if(t){throw`${l(n)}: \`${t}\` expected.`}throw`${l(n)}: ${e} expected.`}return i()}function T(e){let t=e.GetFirstToken,n=e.GetLastToken,o=e;return e.GetFirstToken=function(){let e=t(o);return assert(e),e},e.GetLastToken=function(){let e=n(o);return assert(e),e},e}function p(e,t){let o=[n(e,t)],r=[];for(;","==a().Source;)r.push(i()),o.push(n(e,t));return[o,r]}function c(e,t){let o=a();if("("==o.Source){let o,r=i(),a=n(e,t),l=u("Symbol",")");return o=T({Type:"ParenExpr",Expression:a,Token_OpenParen:r,Token_CloseParen:l,GetFirstToken:()=>o.Token_OpenParen,GetLastToken:()=>o.Token_CloseParen}),o}if("Ident"==o.Type){let n;return n=T({Type:"VariableExpr",Token:i(),GetFirstToken:()=>n.Token,GetLastToken:()=>n.Token}),null!=e[n.Token.Source]&&null!=e[n.Token.Source]?.Tokens?.push?(e[n.Token.Source].Tokens.push(n.Token),e[n.Token.Source].UseCountIncrease()):null!=t[n.Token.Source]&&null!=t[n.Token.Source]?.Tokens?.push&&(t[n.Token.Source].Tokens.push(n.Token),t[n.Token.Source].UseCountIncrease()),n}throw print(function(){let e=a();return`<${e.Type} \`${e.Source}\`> at: ${l(e)}`}()),`${l(o)}: Unexpected symbol. ${o.Type} ${o.Source}`}function f(e){let t=[],n=[];if("Ident"==a().Type)t.push(i());else if("..."==a().Source&&e)return[t,n,i()];for(;","==a().Source;){if(n.push(i()),"..."==a().Source&&e)return[t,n,i()];{let e=u("Ident");t.push(e)}}return[t,n]}function k(e,n,o){let r=t(n,o),s=a();if("Keyword"==s.Type&&s.Source==e)return i(),[r,s];throw print(s.Type,s.Source),`${l(s)}: ${e} expected.`}function y(e,t,n,o){let r,l,s=i();if(!e){r=[],l=[];let e=u("Ident");for(r.push(e);"."==a().Source;)l.push(i()),r.push(u("Ident"));":"==a().Source&&(l.push(i()),r.push(u("Ident")))}let p,c=u("Symbol","("),[y,L,h]=f(!0),S=u("Symbol",")"),[d,E]=k("end",t,n);return p=T({Type:1==e?"FunctionLiteral":"FunctionStat",NameChain:r,ArgList:y,Body:d,Token_Function:s,Token_NameChainSeperator:l,Token_OpenParen:c,Token_Varg:h,Token_ArgCommaList:L,Token_CloseParen:S,Token_End:E,GetFirstToken:()=>p.Token_Function,GetLastToken:()=>p.Token_End}),p}function L(e,t){let o=a();if("("==o.Source){let o=i(),r=[],l=[];for(;")"!=a().Source&&(r.push(n(e,t)),","==a().Source);)l.push(i());let s,p=u("Symbol",")");return s=T({CallType:"ArgCall",ArgList:r,Token_CommaList:l,Token_OpenParen:o,Token_CloseParen:p,GetFirstToken:()=>s.Token_OpenParen,GetLastToken:()=>s.Token_CloseParen}),s}if("{"==o.Source){let o;return o=T({CallType:"TableCall",TableExpr:n(e,t),GetFirstToken:()=>o.TableExpr.GetFirstToken(),GetLastToken:()=>o.TableExpr.GetLastToken()}),o}if("String"==o.Type){let e;return e=T({CallType:"StringCall",Token:i(),GetFirstToken:()=>e.Token,GetLastToken:()=>e.Token}),e}throw"Function arguments expected."}function h(e,t){let o=c(e,t);for(assert(o,"nil prefixexpr");;){let r=a();if("."==r.Source){let e,t=i(),n=u("Ident");e=T({Type:"FieldExpr",Base:o,Field:n,Token_Dot:t,GetFirstToken:()=>e.Base.GetFirstToken(),GetLastToken:()=>e.Field}),o=e}else if(":"==r.Source){let n,r=i(),a=u("Ident"),l=L(e,t);n=T({Type:"MethodExpr",Base:o,Method:a,FunctionArguments:l,Token_Colon:r,GetFirstToken:()=>n.Base.GetFirstToken(),GetLastToken:()=>n.FunctionArguments.GetLastToken()}),o=n}else if("["==r.Source){let r,a=i(),l=n(e,t),s=u("Symbol","]");r=T({Type:"IndexExpr",Base:o,Index:l,Token_OpenBracket:a,Token_CloseBracket:s,GetFirstToken:()=>r.Base.GetFirstToken(),GetLastToken:()=>r.Token_CloseBracket}),o=r}else if("{"==r.Source||"("==r.Source||"String"==r.Type){let n;n=T({Type:"CallExpr",Base:o,FunctionArguments:L(e,t),GetFirstToken:()=>n.Base.GetFirstToken(),GetLastToken:()=>n.FunctionArguments.GetLastToken()}),o=n}else{if(!Compounds.includes(r.Source))return o;{let r,a=i(),l=n(e,t);r=T({Type:"CompoundStat",Base:o,Token_Compound:a,Rhs:l,Lhs:o,GetFirstToken:()=>r.Base.GetFirstToken(),GetLastToken:()=>r.Rhs.GetLastToken()}),o=r}}}}function S(e,t){let o=a();if("Number"==o.Type){let e;return e=T({Type:"NumberLiteral",Token:i(),GetFirstToken:()=>e.Token,GetLastToken:()=>e.Token}),e}if("String"==o.Type){let e;return e=T({Type:"StringLiteral",Token:i(),GetFirstToken:()=>e.Token,GetLastToken:()=>e.Token}),e}if("Hash"==o.Type){let e;return e=T({Type:"HashLiteral",Token:i(),GetFirstToken:()=>e.Token,GetLastToken:()=>e.Token}),e}if("nil"==o.Source){let e;return e=T({Type:"NilLiteral",Token:i(),GetFirstToken:()=>e.Token,GetLastToken:()=>e.Token}),e}if("true"==o.Source||"false"==o.Source){let e;return e=T({Type:"BooleanLiteral",Token:i(),GetFirstToken:()=>e.Token,GetLastToken:()=>e.Token}),e}if("..."==o.Source){let e;return e=T({Type:"VargLiteral",Token:i(),GetFirstToken:()=>e.Token,GetLastToken:()=>e.Token}),e}return"{"==o.Source?function(e,t){let o=u("Symbol","{"),r=[],l=[];for(;"}"!=a().Source;){let o,s;if("["==a().Source){let a=i(),l=n(e,t),T=u("Symbol","]"),p=u("Symbol","="),c=n(e,t);o=l.Token&&l.Token.Source,s=c,r.push({EntryType:"Index",Index:l,Value:c,Token_OpenBracket:a,Token_CloseBracket:T,Token_Equals:p})}else if("Ident"==a().Type&&"="==a(1).Source){let a=i(),l=i(),u=n(e,t);o=a,s=u,r.push({EntryType:"Field",Field:a,Value:u,Token_Equals:l})}else{let o=n(e,t);r.push({EntryType:"Value",Value:o})}if(","!=a().Source&&";"!=a().Source)break;l.push(i())}let s,p=u("Symbol","}");return s=T({Type:"TableLiteral",EntryList:r,Token_SeperatorList:l,Token_OpenBrace:o,Token_CloseBrace:p,GetFirstToken:()=>s.Token_OpenBrace,GetLastToken:()=>s.Token_CloseBrace}),s}(e,t):"function"==o.Source?y(!0,e,t):h(e,t)}function d(e,t,n){let o;if(UnopSet.includes(a().Source)){let e,r=i(),a=d(UnaryPriority,t,n);e=T({Type:"UnopExpr",Token_Op:r,Rhs:a,GetFirstToken:()=>e.Token_Op,GetLastToken:()=>e.Rhs.GetLastToken()}),o=e}else o=S(t,n),assert(o,"nil sipleexpr");for(;BinopSet.includes(a().Source)&&null!=BinaryPriority[a().Source]&&BinaryPriority[a().Source][0]>e;){let e,r=i(),a=d(BinaryPriority[r.Source][1],t,n);assert(a,"RhsNeeded"),e=T({Type:"BinopExpr",Lhs:o,Rhs:a,Token_Op:r,GetFirstToken:()=>e.Lhs.GetFirstToken(),GetLastToken:()=>e.Rhs.GetLastToken()}),o=e}return o}function E(e,t){let o=h(e,t);if("MethodExpr"==o.Type||"CallExpr"==o.Type){let e;return e=T({Type:"CallExprStat",Expression:o,GetFirstToken:()=>e.Expression.GetFirstToken(),GetLastToken:()=>e.Expression.GetLastToken()}),e}if("CompoundStat"==o.Type)return o;{let r=[o],l=[];for(;","==a().Source;){l.push(i());let n=h(e,t);if("MethodExpr"==n.Type||"CallExpr"==n.Type)throw"Bad left hand side of asignment";r.push(n)}let s,p=u("Symbol","="),c=[n(e,t)],f=[];for(;","==a().Source;)f.push(i()),c.push(n(e,t));return s=T({Type:"AssignmentStat",Rhs:c,Lhs:r,Token_Equals:p,Token_LhsSeperatorList:l,Token_RhsSeperatorList:f,GetFirstToken:()=>s.Lhs[0].GetFirstToken(),GetLastToken:()=>s.Rhs[s.Rhs.length-1].GetLastToken()}),s}}function m(e,o){let r=i(),l=n(e,o),s=u("Keyword","then"),p=t(e,o),c=[];for(;"elseif"==a().Source||"else"==a().Source;){let r,a,l=i();"elseif"==l.Source&&(r=n(e,o),a=u("Keyword","then"));let s=t(e,o);if(c.push({Condition:r,Body:s,ClauseType:l.Source,Token:l,Token_Then:a}),"else"==l.Source)break}let f,k=u("Keyword","end");return f=T({Type:"IfStat",Condition:l,Body:p,ElseClauseList:c,Token_If:r,Token_Then:s,Token_End:k,GetFirstToken:()=>f.Token_If,GetLastToken:()=>f.Token_End}),f}function _(e,t){let n,o=i(),[r,a]=k("end",e,t);return n=T({Type:"DoStat",Body:r,Token_Do:o,Token_End:a,GetFirstToken:()=>n.Token_Do,GetLastToken:()=>n.Token_End}),n}function g(e,t){let o,r=i(),a=n(e,t),l=u("Keyword","do"),[s,p]=k("end",e,t);return o=T({Type:"WhileStat",Condition:a,Body:s,Token_While:r,Token_Do:l,Token_End:p,GetFirstToken:()=>o.Token_While,GetLastToken:()=>o.Token_End}),o}function C(e,t){let n=i(),[o,r]=f();if("="==a().Source){let a=i(),[l,s]=p(e,t);if(l.length<2||l.length>3)throw"Expected 2 or 3 values for range bounds";let c,f=u("Keyword","do"),[y,L]=k("end",e,t);return c=T({Type:"NumericForStat",VarList:o,RangeList:l,Body:y,Token_For:n,Token_VarCommaList:r,Token_Equals:a,Token_RangeCommaList:s,Token_Do:f,Token_End:L,GetFirstToken:()=>c.Token_For,GetLastToken:()=>c.Token_End}),c}if("in"==a().Source){let a,l=i(),[s,c]=p(e,t),f=u("Keyword","do"),[y,L]=k("end",e,t);return a=T({Type:"GenericForStat",VarList:o,GeneratorList:s,Body:y,Token_For:n,Token_VarCommaList:r,Token_In:l,Token_GeneratorCommaList:c,Token_Do:f,Token_End:L,GetFirstToken:()=>a.Token_For,GetLastToken:()=>a.Token_End}),a}}function F(e,t){let o,r=i(),[a,l]=k("until",e),s=n(e,t);return o=T({Type:"RepeatStat",Body:a,Condition:s,Token_Repeat:r,Token_Until:l,GetFirstToken:()=>o.Token_Repeat,GetLastToken:()=>o.Condition.GetLastToken()}),o}function x(e,t){let n=i();if("function"==a().Source){let o,r=y(!1,e,t);if(r.NameChain.length>1)throw l(r.Token_NameChainSeperator[0])+": `(` expected.";return o=T({Type:"LocalFunctionStat",FunctionStat:r,Token_Local:n,GetFirstToken:()=>o.Token_Local,GetLastToken:()=>o.FunctionStat.GetLastToken()}),o}if("Ident"==a().Type){let o,r,[l,s]=f(!1),u=[],c=[];if("="==a().Source){o=i();let[n,r]=p(e,t);u=n,c=r}return r=T({Type:"LocalVarStat",VarList:l,ExprList:u,Token_Local:n,Token_Equals:o,Token_VarCommaList:s,Token_ExprCommaList:c,GetFirstToken:()=>r.Token_Local,GetLastToken:function(){return r.ExprList.length>0?r.ExprList[r.ExprList.length-1].GetLastToken():r.VarList[r.VarList.length-1]}}),r}throw"`function` or ident expected"}function b(e,t){let n,o,r,l=i();return s()||";"==a().Source?(n=[],o=[]):[n,o]=p(e,t),r={Type:"ReturnStat",ExprList:n,Token_Return:l,Token_CommaList:o,GetFirstToken:()=>r.Token_Return,GetLastToken:function(){return r.ExprList.length>0?r.ExprList[r.ExprList.length-1].GetLastToken():r.Token_Return}},r}function B(e,t){let n,o=i();return n={Type:"BreakStat",Token_Break:o,GetFirstToken:()=>n.Token_Break,GetLastToken:()=>n.Token_Break},n}function V(e,t){let n,o=i();return n={Type:"ContinueStat",Token_Continue:o,GetFirstToken:()=>n.Token_Continue,GetLastToken:()=>n.Token_Continue},n}function G(e,t){let n=a();return"if"==n.Source?[!1,m(e,t)]:"while"==n.Source?[!1,g(e,t)]:"do"==n.Source?[!1,_(e,t)]:"for"==n.Source?[!1,C(e,t)]:"repeat"==n.Source?[!1,F(e,t)]:"function"==n.Source?[!1,y(!1,e,t)]:"local"==n.Source?[!1,x(e,t)]:"return"==n.Source?[!0,b(e,t)]:"break"==n.Source?[!0,B()]:"continue"==n.Source?[!0,V()]:[!1,E(e,t)]}n=(e,t)=>d(0,e,t);return t=function(e,t){0;let n,o=[],r=[],l={},u={};if(null!=t)for(let[f,k]of Object.entries(t))u[f]=k;if(null!=e)for(let[y,L]of Object.entries(e))u[y]=L;let T,p=0;for(;!s();){n&&n==a()&&print(`INFINITE LOOP POSSIBLE ON STATEMENT ${n.Source} :`,n),n=a();let[h,S]=G(l,u);if(S)switch(o.push(S),S.Type){case"LocalVarStat":S.VarList.forEach((e=>{e.UseCount=0,e.Number=p++,l[e.Source]=e;let t=[];function n(){e.UseCount++,t.forEach((t=>{t.UseCount=e.UseCount}))}e.Tokens={},e.Tokens.push=o=>{o.UseCountIncrease=n,o.UseCount=e.UseCount,o.Tokens=e.Tokens,t.push(o)},e.Tokens.get=()=>t,e.UseCountIncrease=n}));break;case"LocalFunctionStat":let E=S.FunctionStat.NameChain;if(1===E.length){let m=E[0];m.UseCount=0,m.Number=p++,l[m.Source]=m;let _=[];function c(){m.UseCount++,_.forEach((e=>{e.UseCount=m.UseCount}))}m.Tokens={},m.Tokens.push=e=>{e.UseCountIncrease=c,e.UseCount=m.UseCount,e.Tokens=m.Tokens,_.push(e)},m.Tokens.get=()=>_,m.UseCountIncrease=c}}let d=a();"Symbol"==d.Type&&";"==d.Source&&(r[o.length-1]=i())}return T={Type:"StatList",StatementList:o,SemicolonList:r,GetFirstToken:function(){return 0==T.StatementList.length?void 0:T.StatementList[0].GetFirstToken()},GetLastToken:function(){return 0==T.StatementList.length?void 0:T.SemicolonList[T.StatementList.length-1]?T.SemicolonList[T.StatementList.length-1]:T.StatementList[T.StatementList.length-1].GetLastToken()}},T},t([],[])}function VisitAst(e,t){let n,o,r={BinopExpr:!0,UnopExpr:!0,NumberLiteral:!0,StringLiteral:!0,NilLiteral:!0,BooleanLiteral:!0,VargLiteral:!0,HashLiteral:!0,FieldExpr:!0,IndexExpr:!0,MethodExpr:!0,CallExpr:!0,FunctionLiteral:!0,VariableExpr:!0,ParenExpr:!0,TableLiteral:!0},i={StatList:!0,BreakStat:!0,ContinueStat:!0,ReturnStat:!0,LocalVarStat:!0,LocalFunctionStat:!0,FunctionStat:!0,RepeatStat:!0,GenericForStat:!0,NumericForStat:!0,WhileStat:!0,DoStat:!0,IfStat:!0,CallExprStat:!0,AssignmentStat:!0,CompoundStat:!0};for(var[a,l]of Object.entries(t))if(!i[a]&&!r[a])throw`Invalid visitor target: \`${a}\``;function s(e){if(null!=e){let n=t[e.Type];if("function"==typeof n)return n(e);if(n&&n.Pre)return n.Pre(e)}}function u(e){let n=t[e.Type];if(n&&"object"==typeof n&&n.Post)return n.Post(e)}n=function(e){if(!s(e)){if("BinopExpr"==e.Type)n(e.Lhs),n(e.Rhs);else if("UnopExpr"==e.Type)n(e.Rhs);else if("NumberLiteral"==e.Type||"StringLiteral"==e.Type||"NilLiteral"==e.Type||"BooleanLiteral"==e.Type||"VargLiteral"==e.Type||"HashLiteral"==e.Type);else if("FieldExpr"==e.Type)n(e.Base);else if("IndexExpr"==e.Type)n(e.Base),n(e.Index);else if("MethodExpr"==e.Type||"CallExpr"==e.Type)n(e.Base),"ArgCall"==e.FunctionArguments.CallType?e.FunctionArguments.ArgList.forEach(((e,t)=>{n(e)})):"TableCall"==e.FunctionArguments.CallType&&n(e.FunctionArguments.TableExpr);else if("FunctionLiteral"==e.Type)o(e.Body);else if("VariableExpr"==e.Type);else if("ParenExpr"==e.Type)n(e.Expression);else if("TableLiteral"==e.Type)e.EntryList.forEach(((e,t)=>{if("Field"==e.EntryType)n(e.Value);else if("Index"==e.EntryType)n(e.Index),n(e.Value);else{if("Value"!=e.EntryType)throw"unreachable";n(e.Value)}}));else{if("CompoundStat"!=e.Type)throw`unreachable, type: ${e.Type}: ${e}`;n(e.Lhs),n(e.Rhs)}u(e)}},o=function(e){if(!s(e)){if("StatList"==e.Type)e.StatementList.forEach(((t,n)=>{if(null!=t){if(null===t||null===t.Type)return;t.Remove=()=>{e.StatementList[n]=null},o(t)}}));else if("BreakStat"==e.Type);else if("ContinueStat"==e.Type);else if("ReturnStat"==e.Type)e.ExprList.forEach(((e,t)=>{n(e)}));else if("LocalVarStat"==e.Type)e.Token_Equals&&e.ExprList.forEach(((e,t)=>{n(e)}));else if("LocalFunctionStat"==e.Type)o(e.FunctionStat.Body);else if("FunctionStat"==e.Type)o(e.Body);else if("RepeatStat"==e.Type)o(e.Body),n(e.Condition);else if("GenericForStat"==e.Type)e.GeneratorList.forEach(((e,t)=>{n(e)})),o(e.Body);else if("NumericForStat"==e.Type)e.RangeList.forEach(((e,t)=>{n(e)})),o(e.Body);else if("WhileStat"==e.Type)n(e.Condition),o(e.Body);else if("DoStat"==e.Type)o(e.Body);else if("IfStat"==e.Type)n(e.Condition),o(e.Body),e.ElseClauseList.forEach((e=>{null!=e.Condition&&n(e.Condition),o(e.Body)}));else if("CallExprStat"==e.Type)n(e.Expression);else if("CompoundStat"==e.Type)n(e.Lhs),n(e.Rhs);else{if("AssignmentStat"!=e.Type)throw"unreachable";e.Lhs.forEach((e=>{n(e)})),e.Rhs.forEach((e=>{n(e)}))}u(e)}},i[e.Type]?o(e):n(e)}function AddVariableInfo(e){let t,n=[],o=0;function r(){return o++,o}function i(){t={ParentScope:t,ChildScopeList:[],VariableList:[],BeginLocation:r(),Depth:null,GetVar:null},t.ParentScope?(t.Depth=t.ParentScope.Depth+1,t.ParentScope.ChildScopeList.push(t)):t.Depth=1;let e=t;t.GetVar=function(t){for(const n of e.VariableList)if(n.Name==t)return n;if(e.ParentScope)return e.ParentScope.GetVar(t);for(const e of n)if(e.Name==t)return e}}function a(){let e=t;return e.EndLocation=r(),e.VariableList.forEach((t=>{t.ScopeEndLocation=e.EndLocation})),t=e.ParentScope,e}function l(e,n,o){assert(o,"MIssing localInfo"),assert(e,"Missing local var name");let i={Type:"Local",Name:e,RenameList:[n],AssignedTo:!1,Info:o,Scope:t,BeginLocation:r(),EndLocation:r(),ReferenceLocationList:[r()],Rename:function(e){i.Name=e,i.RenameList.forEach((t=>{t(e)}))}};return t.VariableList.push(i),i}function s(e,t){assert(e,"Missing var name");let o=function(e){for(const t of n)if(t.Name==e)return t;let t={Type:"Global",Name:e,RenameList:[],AssignedTo:!1,Scope:null,BeginLocation:r(),EndLocation:r(),ReferenceLocationList:[],Rename:function(e){t.Name=e,t.RenameList.forEach((t=>{t(e)}))}};return n.push(t),t}(e);return o.RenameList.push(t),o}function u(e,t){let n;for(n=e.VariableList.length-1;n>=0;n--)if(e.VariableList[n].Name==t)return e.VariableList[n];if(e.ParentScope){let n=u(e.ParentScope,t);if(n)return n}}function T(e,n){assert(e,"Missing var name");let o=u(t,e);o?o.RenameList.push(n):o=s(e,n);let i=r();return o.EndLocation=i,o.ReferenceLocationList.push(o.EndLocation),o}i();let p={};return p.FunctionLiteral={Pre:function(e){i(),e.ArgList.forEach(((e,t)=>{let n=l(e.Source,(function(t,n){n||(e.Source=t)}),{Type:"Argument",Index:t});e.var=n}))},Post:function(e){a()}},p.VariableExpr=function(e){e.Variable=T(e.Token.Source,(function(t){e.Token.Source=t}))},p.StatList={Pre:function(e){i()},Post:function(e){e.SkipPop||a()}},p.LocalVarStat={Post:function(e){e.VarList.forEach(((t,n)=>{l(t.Source,(function(t){e.VarList[n].Source=t}),{Type:"Local"})}))}},p.LocalFunctionStat={Pre:function(e){l(e.FunctionStat.NameChain[0].Source,(function(t){e.FunctionStat.NameChain[0].Source=t}),{Type:"LocalFunction"}),i(),e.FunctionStat.ArgList.forEach(((e,t)=>{l(e.Source,(function(t){e.Source=t}),{Type:"Argument",Index:t})}))},Post:function(){a()}},p.FunctionStat={Pre:function(e){let n,o=e.NameChain;n=1==o.length?u(t,o[0].Source)?T(o[0].Source,(function(e){o[0].Source=e})):s(o[0].Source,(function(e){o[0].Source=e})):T(o[0].Source,(function(e){o[0].Source=e})),n.AssignedTo=!0,i(),e.ArgList.forEach(((e,t)=>{l(e.Source,(function(t){e.Source=t}),{Type:"Argument",Index:t})}))},Post:function(){a()}},p.GenericForStat={Pre:function(e){return e.GeneratorList.forEach((e=>{VisitAst(e,p)})),i(),e.VarList.forEach(((e,t)=>{l(e.Source,(function(t){e.Source=t}),{Type:"ForRange",Index:t})})),VisitAst(e.Body,p),a(),!0}},p.NumericForStat={Pre:function(e){return e.RangeList.forEach((e=>{VisitAst(e,p)})),i(),e.VarList.forEach(((e,t)=>{l(e.Source,(function(t){e.Source=t}),{Type:"ForRange",Index:t})})),VisitAst(e.Body,p),a(),!0}},p.RepeatStat={Pre:function(e){e.Body.SkipPop=!0},Post:function(e){a()}},p.AssignmentStat={Post:function(e){e.Lhs.forEach((e=>{null!=e.Variable&&(e.Variable.AssignedTo=!0)}))}},VisitAst(e,p),[n,a()]}function PrintAst(e){let t,n,o="";function r(e){if(null==e.LeadingWhite||null==e.Source)throw`Bad token: tk=${e} | lwhite=${e.LeadingWhite} | source=${e.Source}`;o=`${o}${e.LeadingWhite}${e.Source}`}return n=function(e){if("BinopExpr"==e.Type)n(e.Lhs),r(e.Token_Op),n(e.Rhs);else if("UnopExpr"==e.Type)r(e.Token_Op),n(e.Rhs);else if("NumberLiteral"==e.Type||"StringLiteral"==e.Type||"NilLiteral"==e.Type||"BooleanLiteral"==e.Type||"VargLiteral"==e.Type||"HashLiteral"==e.Type)r(e.Token);else if("FieldExpr"==e.Type)n(e.Base),r(e.Token_Dot),r(e.Field);else if("IndexExpr"==e.Type)n(e.Base),r(e.Token_OpenBracket),n(e.Index),r(e.Token_CloseBracket);else if("MethodExpr"==e.Type||"CallExpr"==e.Type)n(e.Base),"MethodExpr"==e.Type&&(r(e.Token_Colon),r(e.Method)),"StringCall"==e.FunctionArguments.CallType?r(e.FunctionArguments.Token):"ArgCall"==e.FunctionArguments.CallType?(r(e.FunctionArguments.Token_OpenParen),e.FunctionArguments.ArgList.forEach(((t,o)=>{n(t);let i=e.FunctionArguments.Token_CommaList[o];null!=i&&r(i)})),r(e.FunctionArguments.Token_CloseParen)):"TableCall"==e.FunctionArguments.CallType&&n(e.FunctionArguments.TableExpr);else if("FunctionLiteral"==e.Type)r(e.Token_Function),r(e.Token_OpenParen),e.ArgList.forEach(((t,n)=>{r(t);let o=e.Token_ArgCommaList[n];null!=o&&r(o)})),null!=e.Token_Varg&&r(e.Token_Varg),r(e.Token_CloseParen),t(e.Body),r(e.Token_End);else if("VariableExpr"==e.Type)r(e.Token);else if("ParenExpr"==e.Type)r(e.Token_OpenParen),n(e.Expression),r(e.Token_CloseParen);else if("TableLiteral"==e.Type)r(e.Token_OpenBrace),e.EntryList.forEach(((t,o)=>{if("Field"==t.EntryType)r(t.Field),r(t.Token_Equals),n(t.Value);else if("Index"==t.EntryType)r(t.Token_OpenBracket),n(t.Index),r(t.Token_CloseBracket),r(t.Token_Equals),n(t.Value);else{if("Value"!=t.EntryType)throw"unreachable";n(t.Value)}let i=e.Token_SeperatorList[o];null!=i&&r(i)})),r(e.Token_CloseBrace);else{if("CompoundStat"!=e.Type)throw`unreachable, type: ${e.Type}: ${e}`;t(e)}},t=function(e){if(null==e)throw`STAT IS NIL! ${e}`;"StatList"==e.Type?e.StatementList.forEach(((n,o)=>{null!==n&&null!==n.Type&&(n.Remove=()=>{e.StatementList[o]=null},t(n),e.SemicolonList[o]&&r(e.SemicolonList[o]))})):"BreakStat"==e.Type?r(e.Token_Break):"ContinueStat"==e.Type?r(e.Token_Continue):"ReturnStat"==e.Type?(r(e.Token_Return),e.ExprList.forEach(((t,o)=>{n(t),e.Token_CommaList[o]&&r(e.Token_CommaList[o])}))):"LocalVarStat"==e.Type?(r(e.Token_Local),e.VarList.forEach(((t,n)=>{r(t);let o=e.Token_VarCommaList[n];null!=o&&r(o)})),null!=e.Token_Equals&&(r(e.Token_Equals),e.ExprList.forEach(((t,o)=>{n(t);let i=e.Token_ExprCommaList[o];null!=i&&r(i)})))):"LocalFunctionStat"==e.Type?(r(e.Token_Local),r(e.FunctionStat.Token_Function),r(e.FunctionStat.NameChain[0]),r(e.FunctionStat.Token_OpenParen),e.FunctionStat.ArgList.forEach(((t,n)=>{r(t);let o=e.FunctionStat.Token_ArgCommaList[n];null!=o&&r(o)})),e.FunctionStat.Token_Varg&&r(e.FunctionStat.Token_Varg),r(e.FunctionStat.Token_CloseParen),t(e.FunctionStat.Body),r(e.FunctionStat.Token_End)):"FunctionStat"==e.Type?(r(e.Token_Function),e.NameChain.forEach(((t,n)=>{r(t);let o=e.Token_NameChainSeperator[n];null!=o&&r(o)})),r(e.Token_OpenParen),e.ArgList.forEach(((t,n)=>{r(t);let o=e.Token_ArgCommaList[n];null!=o&&r(o)})),e.Token_Varg&&r(e.Token_Varg),r(e.Token_CloseParen),t(e.Body),r(e.Token_End)):"RepeatStat"==e.Type?(r(e.Token_Repeat),t(e.Body),r(e.Token_Until),n(e.Condition)):"GenericForStat"==e.Type?(r(e.Token_For),e.VarList.forEach(((t,n)=>{r(t);let o=e.Token_VarCommaList[n];null!=o&&r(o)})),r(e.Token_In),e.GeneratorList.forEach(((t,o)=>{n(t);let i=e.Token_GeneratorCommaList[o];null!=i&&r(i)})),r(e.Token_Do),t(e.Body),r(e.Token_End)):"NumericForStat"==e.Type?(r(e.Token_For),e.VarList.forEach(((t,n)=>{r(t);let o=e.Token_VarCommaList[n];null!=o&&r(o)})),r(e.Token_Equals),e.RangeList.forEach(((t,o)=>{n(t);let i=e.Token_RangeCommaList[o];null!=i&&r(i)})),r(e.Token_Do),t(e.Body),r(e.Token_End)):"WhileStat"==e.Type?(r(e.Token_While),n(e.Condition),r(e.Token_Do),t(e.Body),r(e.Token_End)):"DoStat"==e.Type?(r(e.Token_Do),t(e.Body),r(e.Token_End)):"IfStat"==e.Type?(r(e.Token_If),n(e.Condition),r(e.Token_Then),t(e.Body),e.ElseClauseList.forEach((e=>{r(e.Token),null!=e.Condition&&(n(e.Condition),r(e.Token_Then)),t(e.Body)})),r(e.Token_End)):"CallExprStat"==e.Type?n(e.Expression):"CompoundStat"==e.Type?(n(e.Lhs),r(e.Token_Compound),n(e.Rhs),e.Type="CompoundStat"):"AssignmentStat"==e.Type?(e.Lhs.forEach(((t,o)=>{n(t);let i=e.Token_LhsSeperatorList[o];null!=i&&r(i)})),r(e.Token_Equals),e.Rhs.forEach(((t,o)=>{n(t);let i=e.Token_RhsSeperatorList[o];null!=i&&r(i)}))):assert(!1,"unreachable")},t(e),o}function FormatAst(e){let t,n,o=0;function r(e){let t=`\n${"\t".repeat(o)}`;if(""==e.LeadingWhite||e.LeadingWhite.substr(-t.length,t.length)!=t){let n,o="";for(n=e.LeadingWhite.length;n>=0;n--){let t=e.LeadingWhite.substr(n,1);if(""!=t&&!t.match(/\s/g)){o=e.LeadingWhite.substr(0,n+1);break}}e.LeadingWhite=`${o}${t}`}}function i(){o++}function a(){o--,assert(o>=0,"Undented too far")}function l(e){e.LeadingWhite=e.LeadingWhite.trim()}function s(e){l(e),WhiteChars.includes(function(e){return e.LeadingWhite.length>0?e.LeadingWhite.substr(0,1):e.Source.toString().substr(0,1)}(e))||(e.LeadingWhite=" "+e.LeadingWhite)}function u(e){s(e.GetFirstToken())}function T(e,n,o){i(),t(n),a(),r(o)}n=function(e){if("BinopExpr"==e.Type)n(e.Lhs),n(e.Rhs),u(e.Rhs),s(e.Token_Op);else if("UnopExpr"==e.Type)l(e.Token_Op),n(e.Rhs),e.Token_Op.Source[0]&&s(e.Rhs.GetFirstToken());else if("NumberLiteral"==e.Type||"StringLiteral"==e.Type||"NilLiteral"==e.Type||"BooleanLiteral"==e.Type||"VargLiteral"==e.Type||"HashLiteral"==e.Type)l(e.Token),"HashLiteral"==e.Type&&(e.Token.Source='"'+hashString(`${e.Token.Source.substring(1,e.Token.Source.length-1)}`)+'"',e.Type="StringLiteral",e.Token.Type="String");else if("FieldExpr"==e.Type)n(e.Base);else if("IndexExpr"==e.Type)n(e.Base),n(e.Index);else if("MethodExpr"==e.Type||"CallExpr"==e.Type)n(e.Base),l(e.FunctionArguments.GetFirstToken()),l(e.FunctionArguments.GetLastToken()),e.Type,"StringCall"==e.FunctionArguments.CallType||("ArgCall"==e.FunctionArguments.CallType?e.FunctionArguments.ArgList.forEach(((t,o)=>{n(t),o>0&&u(t);let r=e.FunctionArguments.Token_CommaList[o];null!=r&&l(r)})):"TableCall"==e.FunctionArguments.CallType&&n(e.FunctionArguments.TableExpr));else if("FunctionLiteral"==e.Type)e.ArgList.forEach(((t,n)=>{n>0&&s(t);e.Token_ArgCommaList[n]})),e.ArgList.length>0&&null!=e.Token_Varg&&s(e.Token_Varg),T(e.Token_CloseParen,e.Body,e.Token_End);else if("VariableExpr"==e.Type);else if("ParenExpr"==e.Type)l(e.Token_OpenParen),l(e.Token_CloseParen),n(e.Expression);else if("TableLiteral"==e.Type)if(0==e.EntryList.length);else{i();let t=100;e.EntryList.forEach(((o,i)=>{"Field"==o.EntryType?(e.EntryList.length>t?StripAst(o.Value):r(o.Field),s(o.Token_Equals),n(o.Value),u(o.Value)):"Index"==o.EntryType?(e.EntryList.length>t?l(o.Token_OpenBracket):r(o.Token_OpenBracket),n(o.Index),s(o.Token_Equals),n(o.Value),u(o.Value)):"Value"==o.EntryType?(n(o.Value),e.EntryList.length>t?StripAst(o.Value):r(o.Value.GetFirstToken())):assert(!1,"unreachable");let a=e.Token_SeperatorList[i];null!=a&&(e.EntryList.length>t?a.LeadingWhite="":l(a))})),a(),e.EntryList.length>t?e.Token_CloseBrace.LeadingWhite="":r(e.Token_CloseBrace)}else{if("CompoundStat"!=e.Type)throw print(e),`unreachable, type: ${e.Type}:`+e;t(e)}},t=function(e){if("StatList"==e.Type)e.StatementList.forEach(((e,n)=>{null!==e&&null!==e.Type&&(e.Remove=()=>{e.StatementList[n]=null},t(e),r(e.GetFirstToken()))}));else if("BreakStat"==e.Type);else if("ContinueStat"==e.Type);else if("ReturnStat"==e.Type)e.ExprList.forEach(((t,o)=>{n(t),u(t),e.Token_CommaList[o]}));else if("LocalVarStat"==e.Type){if(e.VarList.forEach(((t,n)=>{s(t);e.Token_VarCommaList[n]})),e.Token_Equals){l(e.Token_Equals),s(e.Token_Equals);let t=[],o=[];e.ExprList.forEach(((n,r)=>{null!=n&&(r<e.VarList.length?(t.push(n),o.push(e.Token_ExprCommaList[r])):"CallExpr"!=n.Type&&"ParenExpr"!=n.Type&&"VargLiteral"!=n.Type&&"BinopExpr"!=n.Type&&"UnopExpr"!=n.Type||(t.push(n),o.push(e.Token_ExprCommaList[r])))})),e.ExprList=t,e.CommaList=o,e.ExprList.forEach(((t,o)=>{if(null!=t){n(t),u(t),null!=e.Token_ExprCommaList[o]&&e.ExprList.length-1==o&&(e.Token_ExprCommaList[o]=null)}}))}}else if("LocalFunctionStat"==e.Type)s(e.FunctionStat.Token_Function),s(e.FunctionStat.NameChain[0]),e.FunctionStat.ArgList.forEach(((t,n)=>{n>0?s(t):l(t);let o=e.FunctionStat.Token_ArgCommaList[n];o&&l(o)})),e.FunctionStat.ArgList.length>0&&e.FunctionStat.Token_Varg?(l(e.FunctionStat.Token_Varg),s(e.FunctionStat.Token_Varg)):e.FunctionStat.Token_Varg&&l(e.FunctionStat.Token_Varg),l(e.FunctionStat.Token_OpenParen),l(e.FunctionStat.Token_CloseParen),T(e.FunctionStat.Token_CloseParen,e.FunctionStat.Body,e.FunctionStat.Token_End);else if("FunctionStat"==e.Type)e.NameChain.forEach(((t,n)=>{0==n&&s(t);e.Token_NameChainSeperator[n]})),e.ArgList.forEach(((t,n)=>{n>0&&s(t);e.Token_ArgCommaList[n]})),e.ArgList.length>0&&e.Token_Varg&&s(e.Token_Varg),T(e.Token_CloseParen,e.Body,e.Token_End);else if("RepeatStat"==e.Type)T(e.Token_Repeat,e.Body,e.Token_Until),n(e.Condition),u(e.Condition);else if("GenericForStat"==e.Type)e.VarList.forEach(((t,n)=>{s(t);e.Token_VarCommaList[n]})),s(e.Token_In),e.GeneratorList.forEach(((t,o)=>{n(t),u(t);e.Token_GeneratorCommaList[o]})),s(e.Token_Do),T(e.Token_Do,e.Body,e.Token_End);else if("NumericForStat"==e.Type)e.VarList.forEach(((t,n)=>{s(t);e.Token_VarCommaList[n]})),s(e.Token_Equals),e.RangeList.forEach(((t,o)=>{n(t),u(t);e.Token_RangeCommaList[o]})),s(e.Token_Do),T(e.Token_Do,e.Body,e.Token_End);else if("WhileStat"==e.Type)n(e.Condition),u(e.Condition),s(e.Token_Do),T(e.Token_Do,e.Body,e.Token_End);else if("DoStat"==e.Type)T(e.Token_Do,e.Body,e.Token_End);else if("IfStat"==e.Type){n(e.Condition),u(e.Condition),s(e.Token_Then);let t=e.Token_Then,o=e.Body;e.ElseClauseList.forEach((e=>{T(0,o,e.Token),t=e.Token,null!=e.Condition&&(n(e.Condition),u(e.Condition),s(e.Token_Then),t=e.Token_Then),o=e.Body})),T(0,o,e.Token_End)}else"CallExprStat"==e.Type?n(e.Expression):"CompoundStat"==e.Type?(n(e.Lhs),n(e.Rhs),u(e.Lhs),u(e.Rhs),s(e.Token_Compound)):"AssignmentStat"==e.Type?(e.Lhs.forEach(((t,o)=>{n(t),o>0&&u(t);e.Token_LhsSeperatorList[o]})),s(e.Token_Equals),e.Rhs.forEach(((t,o)=>{n(t),u(t);e.Token_RhsSeperatorList[o]}))):assert(!1,"Unreachable")},t(e)}function StripAst(e){let t,n;function o(e){e&&(e.LeadingWhite="")}function r(e,t,n=!1){o(t);let r=("string"==typeof e.Source?e.Source:e.Source.toString()).substr(e.Source.length-1,1),i=("string"==typeof t.Source?t.Source:t.Source.toString()).substr(0,1);"-"==r&&"-"==i||AllIdentChars.includes(r)&&AllIdentChars.includes(i)||n&&")"==r&&"("==i?t.LeadingWhite=n?";":" ":t.LeadingWhite=""}function i(e,n,i){t(n),o(i);let a=n.GetFirstToken(),l=n.GetLastToken();null!=a?(r(e,a),r(l,i)):r(e,i)}n=function(e){if("BinopExpr"===e.Type)n(e.Lhs),o(e.Token_Op),n(e.Rhs),r(e.Token_Op,e.Rhs.GetFirstToken()),r(e.Lhs.GetLastToken(),e.Token_Op);else if("UnopExpr"===e.Type)o(e.Token_Op),n(e.Rhs),r(e.Token_Op,e.Rhs.GetFirstToken());else if("NumberLiteral"===e.Type||"StringLiteral"===e.Type||"NilLiteral"===e.Type||"BooleanLiteral"===e.Type||"VargLiteral"===e.Type||"HashLiteral"===e.Type)o(e.Token);else if("FieldExpr"==e.Type)n(e.Base),o(e.Token_Dot),o(e.Field);else if("IndexExpr"==e.Type)n(e.Base),o(e.Token_OpenBracket),n(e.Index),o(e.Token_CloseBracket);else if("MethodExpr"==e.Type||"CallExpr"==e.Type)n(e.Base),"MethodExpr"==e.Type&&(o(e.Token_Colon),o(e.Method)),"StringCall"==e.FunctionArguments.CallType?o(e.FunctionArguments.Token):"ArgCall"==e.FunctionArguments.CallType?(o(e.FunctionArguments.Token_OpenParen),e.FunctionArguments.ArgList.forEach(((t,r)=>{n(t);let i=e.FunctionArguments.Token_CommaList[r];null!=i&&o(i)})),o(e.FunctionArguments.Token_CloseParen)):"TableCall"==e.FunctionArguments.CallType&&n(e.FunctionArguments.TableExpr);else if("FunctionLiteral"==e.Type)o(e.Token_Function),o(e.Token_OpenParen),e.ArgList.forEach(((t,n)=>{o(t);let r=e.Token_ArgCommaList[n];null!=r&&o(r)})),null!=e.Token_Varg&&o(e.Token_Varg),o(e.Token_CloseParen),i(e.Token_CloseParen,e.Body,e.Token_End);else if("VariableExpr"==e.Type)o(e.Token);else if("ParenExpr"==e.Type)o(e.Token_OpenParen),n(e.Expression),o(e.Token_CloseParen);else{if("TableLiteral"!=e.Type)throw`unreachable, type: ${e.Type}:${e}  ${console.trace()}`;o(e.Token_OpenBrace),e.EntryList.forEach(((t,r)=>{"Field"==t.EntryType?(o(t.Field),o(t.Token_Equals),n(t.Value)):"Index"==t.EntryType?(o(t.Token_OpenBracket),n(t.Index),o(t.Token_CloseBracket),o(t.Token_Equals),n(t.Value)):"Value"==t.EntryType?n(t.Value):assert(!1,"unreachable");let i=e.Token_SeperatorList[r];null!=i&&o(i)})),e.Token_SeperatorList[e.EntryList.length-1]=null,o(e.Token_CloseBrace)}},t=function(e){if("StatList"==e.Type){let n;for(n=0;n<=e.StatementList.length;n++){let i=e.StatementList[n];if(null==i)continue;t(i),o(i.GetFirstToken());let a=e.StatementList[n-1];if(null!=a){let t={")":["(","["],"]":["(","["]};if(e.SemicolonList[n-1]){let o=a.GetLastToken().Source,r=i.GetFirstToken().Source;null!==t[o]&&void 0!==t[o]&&t[o].includes(r)||(e.SemicolonList[n-1]=null)}e.SemicolonList[n-1]||r(a.GetLastToken(),i.GetFirstToken(),!0)}}e.SemicolonList[e.StatementList.length-1]=null,e.StatementList.length>0&&o(e.StatementList[0].GetFirstToken())}else if("BreakStat"==e.Type)o(e.Token_Break);else if("ContinueStat"==e.Type)o(e.Token_Continue);else if("ReturnStat"==e.Type)o(e.Token_Return),e.ExprList.forEach(((t,r)=>{n(t),null!=e.Token_CommaList[r]&&o(e.Token_CommaList[r])})),e.ExprList.length>0&&r(e.Token_Return,e.ExprList[0].GetFirstToken());else if("LocalVarStat"==e.Type)o(e.Token_Local),e.VarList.forEach(((t,n)=>{0==n?r(e.Token_Local,t):o(t);let i=e.Token_VarCommaList[n];null!=i&&o(i)})),null!=e.Token_Equals&&(o(e.Token_Equals),e.ExprList.forEach(((t,r)=>{n(t);let i=e.Token_ExprCommaList[r];null!=i&&o(i)})));else if("LocalFunctionStat"==e.Type)o(e.Token_Local),r(e.Token_Local,e.FunctionStat.Token_Function),r(e.FunctionStat.Token_Function,e.FunctionStat.NameChain[0]),r(e.FunctionStat.NameChain[0],e.FunctionStat.Token_OpenParen),e.FunctionStat.ArgList.forEach(((t,n)=>{o(t);let r=e.FunctionStat.Token_ArgCommaList[n];null!=r&&o(r)})),e.FunctionStat.Token_Varg&&o(e.FunctionStat.Token_Varg),o(e.FunctionStat.Token_CloseParen),i(e.FunctionStat.Token_CloseParen,e.FunctionStat.Body,e.FunctionStat.Token_End);else if("FunctionStat"==e.Type)o(e.Token_Function),e.NameChain.forEach(((t,n)=>{0==n?r(e.Token_Function,t):o(t);let i=e.Token_NameChainSeperator[n];null!=i&&o(i)})),o(e.Token_OpenParen),e.ArgList.forEach(((t,n)=>{o(t);let r=e.Token_ArgCommaList[n];null!=r&&o(r)})),e.Token_Varg&&o(e.Token_Varg),o(e.Token_CloseParen),i(e.Token_CloseParen,e.Body,e.Token_End);else if("RepeatStat"==e.Type)o(e.Token_Repeat),i(e.Token_Repeat,e.Body,e.Token_Until),n(e.Condition),r(e.Token_Until,e.Condition.GetFirstToken());else if("GenericForStat"==e.Type)o(e.Token_For),e.VarList.forEach(((t,n)=>{0==n?r(e.Token_For,t):o(t);let i=e.Token_VarCommaList[n];null!=i&&o(i)})),r(e.VarList[e.VarList.length-1],e.Token_In),e.GeneratorList.forEach(((t,i)=>{n(t),0==i&&r(e.Token_In,t.GetFirstToken());let a=e.Token_GeneratorCommaList[i];null!=a&&o(a)})),r(e.GeneratorList[e.GeneratorList.length-1].GetLastToken(),e.Token_Do),i(e.Token_Do,e.Body,e.Token_End);else if("NumericForStat"==e.Type)o(e.Token_For),e.VarList.forEach(((t,n)=>{0==n?r(e.Token_For,t):o(t);let i=e.Token_VarCommaList[n];null!=i&&o(i)})),r(e.VarList[e.VarList.length-1],e.Token_Equals),e.RangeList.forEach(((t,i)=>{n(t),0==i&&r(e.Token_Equals,t.GetFirstToken());let a=e.Token_RangeCommaList[i];null!=a&&o(a)})),r(e.RangeList[e.RangeList.length-1].GetLastToken(),e.Token_Do),i(e.Token_Do,e.Body,e.Token_End);else if("WhileStat"==e.Type)o(e.Token_While),n(e.Condition),o(e.Token_Do),r(e.Token_While,e.Condition.GetFirstToken()),r(e.Condition.GetLastToken(),e.Token_Do),i(e.Token_Do,e.Body,e.Token_End);else if("DoStat"==e.Type)o(e.Token_Do),o(e.Token_End),i(e.Token_Do,e.Body,e.Token_End);else if("IfStat"==e.Type){o(e.Token_If),n(e.Condition),r(e.Token_If,e.Condition.GetFirstToken()),r(e.Condition.GetLastToken(),e.Token_Then);let a=e.Token_Then,l=e.Body;e.ElseClauseList.forEach(((e,o)=>{i(a,l,e.Token),a=e.Token,null!=e.Condition&&(n(e.Condition),r(e.Token,e.Condition.GetFirstToken()),r(e.Condition.GetLastToken(),e.Token_Then),a=e.Token_Then),t(e.Body),l=e.Body})),i(a,l,e.Token_End)}else if("CallExprStat"==e.Type)n(e.Expression);else if("CompoundStat"==e.Type)n(e.Lhs),o(e.Token_Compound),n(e.Rhs),r(e.Lhs.GetLastToken(),e.Token_Compound),r(e.Token_Compound,e.Rhs.GetFirstToken());else{if("AssignmentStat"!=e.Type)return n(e);e.Lhs.forEach(((t,r)=>{n(t);let i=e.Token_LhsSeperatorList[r];null!=i&&o(i)})),o(e.Token_Equals),e.Rhs.forEach(((t,r)=>{n(t);let i=e.Token_RhsSeperatorList[r];null!=i&&o(i)}))}},t(e)}function SolveMath(e){let t,n,o={NumberLiteral:!0,BooleanLiteral:!0,StringLiteral:!0,HashLiteral:!0,NilLiteral:!0,TableLiteral:!0,ParenExpr:!0,BinopExpr:!0};function r(e,t,n=null){let o;return o={Type:e,Token:{Type:null==n?"Number":n,LeadingWhite:"",Source:t},GetFirstToken:()=>o.Token,GetLastToken:()=>o.Token},o}function i(e,t){let n;return n={Type:"UnopExpr",Token_Op:{Type:"Symbol",LeadingWhite:"",Source:e},Rhs:t,GetFirstToken:()=>n.Token_Op,GetLastToken:()=>n.Rhs.GetLastToken()},n}function a(e,t){if(null!=t)for(var[n,o]of Object.entries(t))e[n]=o}function l(e){if(null==e||null==e.substr)return;let t,n=e.substr(0,1);if('"'!=n&&"'"!=n||(t=e.substr(1,e.length-2)),"["==n){let n=0,o=1;for(;"="==e.substr(o,1);)n++,o++;t=e.substr(2+n,e.length-4-n-2)}if(null==t)return"";let o,r="";for(o=0;o<=t.length;o++){let e=t.substr(o,1);r+="'"==e||'"'==e?`\\${e}`:e}return r}function s(e){if("object"==typeof e&&"ParenExpr"==e.Type)return a(e,e.Expression)}n=function(e){if("BinopExpr"==e.Type){if(n(e.Lhs),n(e.Rhs),null!=e.Lhs&&null!=e.Rhs){let t=e.Token_Op;if(null!=t&&null!=t.Source){let n=function(e,t,n){let o=t,r=n;if(t&&"ParenExpr"==t.Type&&(o=t.Expression),n&&"ParenExpr"==n.Type&&(r=n.Expression),null==o||null==r||null==o.Type||null==r.Type)return;if("VariableExpr"==o.Type||"CallExpr"==o.Type||"BinopExpr"==o.Type||"CallExpr"==r.Type||"BinopExpr"==r.Type||"VariableExpr"==r.Type)return;let i,a,s=o.Token||null!=o.Expression&&o.Expression.Token||null,u=r.Token||null!=r.Expression&&r.Expression.Token||null,T=null!=s?s.Source:null,p=null!=u?u.Source:null;if("BooleanLiteral"==o.Type&&(i="true"==T),"BooleanLiteral"==r.Type&&(a="true"==p),!("NumberLiteral"==o.Type&&(i=parseFloat(T),null==i)||"NumberLiteral"==r.Type&&(a=parseFloat(p),null==a)||("StringLiteral"!=o.Type&&"HashLiteral"!=o.Type||(i=T.toString()),"StringLiteral"!=r.Type&&"HashLiteral"!=r.Type||(a=p.toString()),null==i||null==a))){if("=="==e)return i==a;if("~="==e)return i!=a;if("and"==e)return i&&a;if("or"==e)return i||a;if(".."==e&&"StringLiteral"==o.Type&&"StringLiteral"==r.Type)return`"${l(T)+l(p)}"`;if("StringLiteral"==o.Type&&(i=parseFloat(l(i))),"StringLiteral"==r.Type&&(a=parseFloat(l(a))),null==i||null==a)return;let t;if("+"==e&&(t=i+a),"-"==e&&(t=i-a),"*"==e&&(t=i*a),"/"==e&&(t=i/a),"^"==e&&(t=i**a),"%"==e&&(t=i%a),">"==e&&(t=i>a),"<"==e&&(t=i<a),">="==e&&(t=i>=a),"<="==e&&(t=i<=a),0==t||1==t||isFinite(t)&&t>-1e6&&t<10**6)return t}}(t.Source,e.Lhs,e.Rhs);if(null!=n){if("boolean"==typeof n){let t=r("BooleanLiteral",n.toString(),"Keyword");return void a(e,t)}if("number"==typeof n){if(1==isFinite(n)){let t=r("NumberLiteral",n.toString(),"Number");return void a(e,t)}}else{if("string"==typeof n){let t=r("StringLiteral",n,"String");return void a(e,t)}if("object"==typeof n)return void a(e,n)}return}}if("ParenExpr"==e.Lhs.Type){let t=e.Lhs.Expression;"NumberLiteral"==t.Type||"StringLiteral"==t.Type||"NilLiteral"==t.Type||"BooleanLiteral"==t.Type||t.Type}if("ParenExpr"==e.Rhs.Type){let t=e.Rhs.Expression;"NumberLiteral"==t.Type||"StringLiteral"==t.Type||"NilLiteral"==t.Type||"BooleanLiteral"==t.Type||t.Type}}}else if("UnopExpr"==e.Type){if(n(e.Rhs),null!=e.Rhs&&1==o[e.Rhs.Type]){let t=e.Token_Op;if(null!=t&&null!=t.Source){let n=null!=e.Rhs.Expression?e.Rhs.Expression:e.Rhs,o=function(e,t){let n=t.Token||t.Expression||t.EntryList||t;if(null==n)return;if(null==n.Source&&"TableLiteral"!=t.Type)return;if("VariableExpr"==t.Type||"CallExpr"==t.Type||"BinopExpr"==t.Type)return;let o,a=n.Source;if("TableLiteral"==t.Type&&null!=n){let o=[],a=0,l=!1,s=!1,u=0;if(n.forEach(((e,t)=>{if(l)o.push(e);else if("Value"==e.EntryType||"Index"==e.EntryType)if(null!=e.Index&&"NumberLiteral"!=e.Index.Type||!e.Value)o.push(e);else{if((null!=e.Index&&null!=e.Index.Token&&null!==e.Index.Token.Source?e.Index.Token.Source:u+1).toString()!==(++u).toString())return l=!0,s=!0,o.push(e);"CallExpr"!=e.Value.Type?a++:(l=!0,o.push(e))}})),s)return;if("#"==e){if(t.EntryList=o,t.EntryList.length<=0)return r("NumberLiteral",null!==a?a:t.EntryList.length);if(a<=0)return i("#",t);let e=function(e,t,n){let o;return o={Type:"BinopExpr",Token_Op:{Type:"Symbol",LeadingWhite:"",Source:e},Lhs:t,Rhs:n,GetFirstToken:()=>o.Lhs.GetFirstToken(),GetLastToken:()=>o.Rhs.GetLastToken()},o}("+",r("NumberLiteral",a),i("#",t));return e}}if("BooleanLiteral"==t.Type&&(o="true"==a),"NumberLiteral"!=t.Type||(o=parseFloat(a),null!==o)){if("StringLiteral"==t.Type&&(o=a.substr(1,a.length-2)),"not"==e&&null!==t.Type)return"NilLiteral"==t.Type||"BooleanLiteral"==t.Type&&!1===o;if(null!=o){if("#"==e)return o.length;if("-"==e)return-o}}}(t.Source,n);if(null!=o){if("boolean"==typeof o){let t=r("BooleanLiteral",o.toString(),"Keyword");return void a(e,t)}if("number"==typeof o){if(1==isFinite(o)){let t=r("NumberLiteral",o,"Number");return void a(e,t)}}else{if("string"==typeof o){let t=r("StringLiteral",o,"String");return void a(e,t)}if("object"==typeof o)return void a(e,o)}return}}}}else if("NumberLiteral"==e.Type||"StringLiteral"==e.Type||"NilLiteral"==e.Type||"BooleanLiteral"==e.Type||"VargLiteral"==e.Type||"HashLiteral"==e.Type){let t=e.Token;if(null!=t){if("Number"==t.Type){let e=t.Source.toString().split("e");if(2===e.length){let n=parseFloat(e[0]),o=parseFloat(e[1]);isFinite(n)&&isFinite(o)&&n**o<999999999&&!t.Source.includes("+")&&t.Source.includes(".")&&!t.Source.includes("-")&&(t.Source=(n**o).toString())}}"String"==t.Type&&(t.Source=t.Source.replace(/\\\d+/gi,(e=>{let t=parseFloat(e.substr(1,e.length-1));return t&&isFinite(t)&&(t>=97&&t<=122||t>=65&&t<=90||t>=33&&t<=47||t>=58&&t<=64||t>=91&&t<=96||t>=123&&t<=126)&&34!==t&&39!==t&&92!==t?String.fromCharCode(t):e})))}}else if("FieldExpr"==e.Type)n(e.Base);else if("IndexExpr"==e.Type)n(e.Base),n(e.Index);else if("MethodExpr"==e.Type||"CallExpr"==e.Type){if(n(e.Base),"ArgCall"==e.FunctionArguments.CallType?e.FunctionArguments.ArgList.forEach(((e,t)=>{n(e)})):"TableCall"==e.FunctionArguments.CallType&&n(e.FunctionArguments.TableExpr),"ParenExpr"===e.Base.Type&&"FunctionLiteral"===e.Base.Expression.Type&&"ArgCall"===e.FunctionArguments.CallType){let t=e.Base.Expression;e.FunctionArguments.ArgList.forEach(((n,o)=>{let r=e.FunctionArguments.ArgList[o];if(void 0!==r&&("NumberLiteral"==r.Type||"StringLiteral"==r.Type||"NilLiteral"==r.Type||"BooleanLiteral"==r.Type||"HashLiteral"==r.Type)){let e=t.ArgList[o];e&&e.var.RenameList.forEach((e=>{e(r.Token.Source,!0)}))}}))}}else if("FunctionLiteral"==e.Type)t(e.Body);else if("VariableExpr"==e.Type);else if("ParenExpr"==e.Type){let t=e.Expression;null!=t&&"ParenExpr"==t.Type&&(e.Expression=t.Expression),n(e.Expression),"NumberLiteral"!=e.Type&&"StringLiteral"!=e.Type&&"NilLiteral"!=e.Type&&"BooleanLiteral"!=e.Type&&"VargLiteral"!=e.Type&&"HashLiteral"!=e.Type||s(e)}else"TableLiteral"==e.Type&&e.EntryList.forEach(((e,t)=>{"Field"==e.EntryType?n(e.Value):"Index"==e.EntryType?(n(e.Index),n(e.Value)):"Value"==e.EntryType?n(e.Value):assert(!1,"unreachable")}))},t=function(e){if("StatList"==e.Type)e.StatementList.forEach(((n,o)=>{null!==n&&null!==n.Type&&(n.Remove=()=>{e.StatementList[o]=null},t(n))}));else if("BreakStat"==e.Type);else if("ContinueStat"==e.Type);else if("ReturnStat"==e.Type)e.ExprList.forEach(((e,t)=>{n(e)}));else if("LocalVarStat"==e.Type)null!=e.Token_Equals&&e.ExprList.forEach(((e,t)=>{n(e)}));else if("LocalFunctionStat"==e.Type)t(e.FunctionStat.Body),1===e.FunctionStat.NameChain.length&&e.FunctionStat.NameChain[0].UseCount;else if("FunctionStat"==e.Type)t(e.Body);else if("RepeatStat"==e.Type)t(e.Body),n(e.Condition),"StatList"==e.Body.Type&&e.Body.StatementList.length;else if("GenericForStat"==e.Type)e.GeneratorList.forEach(((e,t)=>{n(e)})),t(e.Body);else if("NumericForStat"==e.Type){e.RangeList.forEach(((e,t)=>{n(e)})),t(e.Body);let o=e.RangeList[0],r=e.RangeList[1],i=e.RangeList[2];if(null==o||null==r)return e.Remove();if(s(o),s(r),s(i),"NumberLiteral"!=o.Type||"NumberLiteral"!=r.Type||null!=i&&"NumberLiteral"!=i.Type||null==i)return;let a=parseFloat(o.Token.Source),l=parseFloat(r.Token.Source),u=null!=i&&parseFloat(i.Token.Source)||1;if(!((u>0&&a<=l||u<0&&a>=l)&&(l-a+u)/u>=0))return e.Remove();if("StatList"==e.Body.Type&&0===e.Body.StatementList.length)return e.Remove()}else if("WhileStat"==e.Type){n(e.Condition),t(e.Body);let o=e.Condition;switch(o.Type){case"ParenExpr":o=o.Expression;case"BooleanLiteral":if(null==o||null==o.Token||"false"!==o.Token.Source)break;case"NilLiteral":e.Remove()}}else if("DoStat"==e.Type){if(t(e.Body),null===e.Body||"StatList"==e.Body.Type&&0===e.Body.StatementList.length)return e.Remove();if(1===e.Body.StatementList.length){let t=e.Body.StatementList[0];"ContinueStat"!==t.Type&&"BreakStat"!==t.Type&&"ReturnStat"!==t.Type&&a(e,t)}}else if("IfStat"==e.Type){n(e.Condition),t(e.Body),e.ElseClauseList.forEach(((e,o)=>{null!=e.Condition&&n(e.Condition),t(e.Body)}));let o=e.Condition;switch(o.Type){case"ParenExpr":o=o.Expression;case"BooleanLiteral":if(e.ElseClauseList.length>=1||null==o||null==o.Token||"false"!==o.Token.Source)break;case"NilLiteral":e.Remove()}}else"CallExprStat"==e.Type?n(e.Expression):"CompoundStat"==e.Type?(n(e.Lhs),n(e.Rhs)):"AssignmentStat"==e.Type&&(e.Lhs.forEach(((e,t)=>{n(e)})),e.Rhs.forEach(((e,t)=>{n(e)})))},t(e)}let i,idGen=0,VarDigits=[];for(i="a".charCodeAt();i<="z".charCodeAt();i++)VarDigits.push(String.fromCharCode(i));for(i="A".charCodeAt();i<="Z".charCodeAt();i++)VarDigits.push(String.fromCharCode(i));for(i="0".charCodeAt();i<="9".charCodeAt();i++)VarDigits.push(String.fromCharCode(i));VarDigits.push("_");let VarStartDigits=[];for(i="a".charCodeAt();i<="z".charCodeAt();i++)VarStartDigits.push(String.fromCharCode(i));for(i="A".charCodeAt();i<="Z".charCodeAt();i++)VarStartDigits.push(String.fromCharCode(i));function indexToVarName(e){let t="",n=e%VarStartDigits.length;for(e=(e-n)/VarStartDigits.length,t=`${t}${VarStartDigits[n]}`;e>0;){let n=e%VarDigits.length;e=(e-n)/VarDigits.length,t=`${t}${VarDigits[n]}`}return t}function genNextVarName(){let e=idGen;return idGen++,indexToVarName(e)}function genVarName(){let e=genNextVarName();for(;Keywords.includes(e);)e=genNextVarName();return e}function MinifyVariables(e,t){let n=[],o=0;e.forEach((e=>{e.AssignedTo?(e.Rename(`_TMP_${o}_`),o++):n[e.Name]=!0}));let r=0;e.forEach((e=>{if(e.AssignedTo){let t="";for(t=indexToVarName(r),r++;Keywords.includes(t)||n[t];)t=indexToVarName(r),r++;e.Rename(t)}})),t.FirstFreeName=r,function e(t){t.VariableList.forEach((e=>{let o="";for(o=indexToVarName(t.FirstFreeName),t.FirstFreeName++;Keywords.includes(o)||n[o];)o=indexToVarName(t.FirstFreeName),t.FirstFreeName++;e.Rename(o)})),t.ChildScopeList.forEach((n=>{n.FirstFreeName=t.FirstFreeName,e(n)}))}(t)}function MinifyVariables_2(e,t,n){let o=[];for(var[r,i]of Object.entries(Keywords))o[r]=!0;let a=[],l=[];e.forEach((e=>{e.AssignedTo&&n?a.push(e):o[e.Name]=!0})),function e(t){t.VariableList.forEach((e=>{a.push(e),l.push(e)})),t.ChildScopeList.forEach((t=>{e(t)}))}(t),a.forEach((e=>{e.UsedNameArray=[]})),a.sort(((e,t)=>e-t));let s=0,u=[];a.forEach(((e,t)=>{e.Renamed=!0;let n=0;for(;e.UsedNameArray[n];)n++;e.Rename(function(e){let t=u[e];if(null==t){for(t=indexToVarName(s),s++;o[t];)t=indexToVarName(s),s++;u[e]=t}return t}(n)),e.Scope?a.forEach((t=>{t.Renamed||(!t.Scope||t.Scope.Depth<e.Scope.Depth?t.ReferenceLocationList.some((o=>o>=e.BeginLocation&&o<=e.ScopeEndLocation&&(t.UsedNameArray[n]=!0,!0))):t.Scope.Depth>e.Scope.Depth?e.ReferenceLocationList.some((e=>e>=t.BeginLocation&&e<=t.ScopeEndLocation&&(t.UsedNameArray[n]=!0,!0))):e.BeginLocation<t.EndLocation&&e.EndLocation>t.BeginLocation&&(t.UsedNameArray[n]=!0))})):a.forEach((t=>{if(!t.Renamed)if("Global"==t.Type)t.UsedNameArray[n]=!0;else{if("Local"!=t.Type)throw"Unreachable";e.ReferenceLocationList.some((e=>e>=t.BeginLocation&&e<=t.ScopeEndLocation&&(t.UsedNameArray[n]=!0,!0)))}}))}))}function BeautifyVariables(e,t,n){let o=[];e.forEach((e=>{e.AssignedTo&&n||(o[e.Name]=!0)}));let r=1,i=1;function a(e,t){e.Name=t,e.RenameList.forEach((e=>{e(t)}))}if(n){let t={};e.forEach((e=>{e.AssignedTo&&!e.ChangedName&&(t[e.Name]=t[e.Name]||`G_${i}_`,e.ChangedName=!0,a(e,t[e.Name]),i++)}))}!function e(t){t.VariableList.forEach((e=>{let t=`L_${r}_`;"Argument"==e.Info.Type?t=`${t}arg${e.Info.Index}`:"LocalFunction"==e.Info.Type?t=`${t}func`:"ForRange"==e.Info.Type&&(t=`${t}forvar${e.Info.Index}`),a(e,t),r++})),t.ChildScopeList.forEach((t=>{e(t)}))}(t)}let luaminp={};export function Minify(e,t){let n=CreateLuaParser(e),[o,r]=AddVariableInfo(n);return 1==t.RenameVariables&&MinifyVariables_2(o,r,t.RenameGlobals),1==t.SolveMath&&SolveMath(n),StripAst(n),PrintAst(n)}export function Beautify(e,t){let n=CreateLuaParser(e),[o,r]=AddVariableInfo(n);return t.RenameVariables&&BeautifyVariables(o,r,t.RenameGlobals),1==t.SolveMath&&SolveMath(n),FormatAst(n),PrintAst(n)}